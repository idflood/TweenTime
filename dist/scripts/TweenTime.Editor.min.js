!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("signals"),require("lodash"),require("d3"),require("jquery"),require("draggable-number.js"),require("spectrum-colorpicker"),require("file-saver")):"function"==typeof define&&define.amd?define(["signals","lodash","d3","jquery","DraggableNumber","spectrum","file-saver"],t):"object"==typeof exports?exports.Editor=t(require("signals"),require("lodash"),require("d3"),require("jquery"),require("draggable-number.js"),require("spectrum-colorpicker"),require("file-saver")):(e.TweenTime=e.TweenTime||{},e.TweenTime.Editor=t(e.signals,e._,e.d3,e.$,e.DraggableNumber,e.spectrum,e.saveAs))}(this,function(e,t,i,n,r,a,s){return function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=i(7),o=n(s),l=i(17),u=n(l),c=i(33),h=n(c),d=i(35),p=n(d),f=i(36),m=n(f),v=i(37),g=n(v),y=i(38),b=n(y),_=i(39),k=i(3),w=function(){function e(t){var i=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];r(this,e),this.tweenTime=t,this.options=n,this.timer=this.tweenTime.timer,this.lastTime=-1,this.onKeyAdded=this.onKeyAdded.bind(this),this.onKeyRemoved=this.onKeyRemoved.bind(this);var a=n.el||$("body");this.el=a,this.$timeline=$(_()),a.append(this.$timeline),a.addClass("has-editor"),this.selectionManager=new m["default"](this.tweenTime),this.exporter=new g["default"](this),this.timeline=new o["default"](this,n),this.propertiesEditor=new u["default"](this,this.selectionManager),this.propertiesEditor.keyAdded.add(this.onKeyAdded),this.propertiesEditor.keyRemoved.add(this.onKeyRemoved),this.menu=new h["default"](this.tweenTime,this.$timeline,this),void 0!==this.options.onMenuCreated&&this.options.onMenuCreated(this.$timeline.find(".timeline__menu"),this),this.controls=new p["default"](this.tweenTime,this.$timeline),this.undoManager=new b["default"](this),this.onSelect=new k.Signal;var s=this;this.selectionManager.onSelect.add(function(e,t){s.onSelect.dispatch(e,t)}),window.editorEnabled=!0,window.dispatchEvent(new Event("resize")),window.requestAnimationFrame(function(){return i.update()})}return a(e,[{key:"select",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];this.selectionManager.select(e,t)}},{key:"getSelection",value:function(){return this.selectionManager.getSelection()}},{key:"onKeyAdded",value:function(){this.undoManager.addState(),this.render(!1,!1,!0)}},{key:"onKeyRemoved",value:function(e){this.selectionManager.removeItem(e._id),this.undoManager.addState(),this.selectionManager.selection.length&&this.selectionManager.triggerSelect(),this.render(!1,!1,!0)}},{key:"render",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0],t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],i=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],n=e;n===!1&&(n=this.timer.time[0]),i&&(this.timeline._isDirty=!0),this.timeline.render(n,t),this.controls.render(n,t),this.propertiesEditor.render(n,t)}},{key:"update",value:function(){var e=this,t=this.timer.time[0],i=this.lastTime===t?!1:!0;this.render(t,i),this.lastTime=this.timer.time[0],window.requestAnimationFrame(function(){return e.update()})}}]),e}();e.exports=w},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(){i(this,e)}return n(e,null,[{key:"formatMinutes",value:function(e){var t=e/1e3,i=Math.floor(t/3600),n=Math.floor((t-3600*i)/60);t-=60*n;var r=t+"s";return n&&(r=n+"m "+r),i&&(r=i+"h "+r),r}},{key:"getClosestTime",value:function(e,t){var i=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],n=arguments.length<=3||void 0===arguments[3]?!1:arguments[3],r=arguments.length<=4||void 0===arguments[4]?!1:arguments[4],a=arguments.length<=5||void 0===arguments[5]?.1:arguments[5];if(r){var s=r.getCurrentTime()/1e3;if(Math.abs(s-t)<=a)return s}if(i||n)for(var o=0;o<e.length;o++){var l=e[o];if(l.id!==i||n){if(Math.abs(l.start-t)<=a)return l.start;if(Math.abs(l.end-t)<=a)return l.end}for(var u=0;u<l.properties.length;u++){var c=l.properties[u];if(c.keys&&(l.id!==i||c.name!==n))for(var h=0;h<c.keys.length;h++){var d=c.keys[h];if(Math.abs(d.time-t)<=a)return d.time}}}return!1}},{key:"getPreviousKey",value:function(e,t){for(var i=!1,n=0;n<e.length;n++){var r=e[n];if(!(r.time<t))return i;i=r}return i}},{key:"sortKeys",value:function(e){var t=function(e,t){return e.time<t.time?-1:e.time>t.time?1:0};return e.sort(t)}},{key:"guid",value:function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}]),e}();t["default"]=r},,function(t,i){t.exports=e},,,function(e,i){e.exports=t},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=i(1),o=n(s),l=i(8),u=n(l),c=i(10),h=n(c),d=i(11),p=n(d),f=i(12),m=n(f),v=i(13),g=n(v),y=i(14),b=n(y),_=i(15),k=n(_),w=i(16),x=n(w),T=i(9),D=function(){function e(t,i){var n=this;r(this,e),this.editor=t,this.tweenTime=this.editor.tweenTime,this.timer=this.tweenTime.timer,this.selectionManager=this.editor.selectionManager,this._isDirty=!0,this.timer=this.tweenTime.timer,this.currentTime=this.timer.time,this.onUpdate=this.onUpdate.bind(this),this.initialDomain=[],this.initialDomain[0]=i.domainStart||0,this.initialDomain[1]=i.domainEnd||.2*this.timer.totalDuration,this.initialDomain[0]>this.timer.getCurrentTime()&&(this.timer.time[0]=this.initialDomain[0]);var a={top:6,right:20,bottom:0,left:265};this.margin=a;var s=window.innerWidth-a.left-a.right,l=270-a.top-a.bottom-40;this.lineHeight=20,this.label_position_x=-a.left+20,this.x=T.time.scale().domain(this.initialDomain).range([0,s]),this.xAxis=T.svg.axis().scale(this.x).orient("top").tickSize(-l,0).tickFormat(o["default"].formatMinutes),this.svg=T.select(t.$timeline.get(0)).select(".timeline__main").append("svg").attr("width",s+a.left+a.right).attr("height",600),this.svgContainer=this.svg.append("g").attr("transform","translate("+a.left+","+a.top+")"),this.svgContainerTime=this.svg.append("g").attr("transform","translate("+a.left+",0)"),this.linesContainer=this.svg.append("g").attr("transform","translate("+a.left+","+a.top+")"),this.header=new u["default"](t,this.timer,this.initialDomain,this.tweenTime,s,a),this.timeIndicator=new h["default"](this,this.svgContainerTime),this.selection=new x["default"](this,this.svg,a),this.items=new p["default"](this,this.linesContainer),this.items.onUpdate.add(this.onUpdate),this.keysPreview=new m["default"](this,this.linesContainer),this.properties=new g["default"](this),this.properties.onKeyAdded.add(function(e,t){n._isDirty=!0,n.render(0,!1),n.keys.selectNewKey(e,t)}),this.errors=new k["default"](this),this.keys=new b["default"](this),this.keys.onKeyUpdated.add(function(){n.onUpdate()}),this.xAxisGrid=T.svg.axis().scale(this.x).ticks(100).tickSize(-this.items.dy,0).tickFormat("").orient("top"),this.xGrid=this.svgContainer.append("g").attr("class","x axis grid").attr("transform","translate(0,"+a.top+")").call(this.xAxisGrid),this.xAxisElement=this.svgContainer.append("g").attr("class","x axis").attr("transform","translate(0,"+a.top+")").call(this.xAxis),this.header.onBrush.add(function(e){n.x.domain(e),n.xGrid.call(n.xAxisGrid),n.xAxisElement.call(n.xAxis),n._isDirty=!0}),window.requestAnimationFrame(function(){n.render()}),window.onresize=function(){var e=window.innerWidth,t=e-a.left-a.right;n.svg.attr("width",t+a.left+a.right),n.svg.selectAll(".timeline__right-mask").attr("width",e),n.x.range([0,t]),n._isDirty=!0,n.header.resize(e),n.render()}}return a(e,[{key:"onUpdate",value:function(){this.editor.render(!1,!1,!0)}},{key:"render",value:function(e,t){if(t){var i,n=16;this.timer.getCurrentTime()>this.initialDomain[1]&&(i=this.initialDomain[1]-this.initialDomain[0],this.initialDomain[0]+=i-n,this.initialDomain[1]+=i-n,this.header.setDomain(this.initialDomain)),this.timer.getCurrentTime()<this.initialDomain[0]&&(i=this.initialDomain[1]-this.initialDomain[0],this.initialDomain[0]=this.timer.getCurrentTime(),this.initialDomain[1]=this.initialDomain[0]+i,this.header.setDomain(this.initialDomain))}if((this._isDirty||t)&&(this.header.render(),this.timeIndicator.render()),this._isDirty){var r=this.items.render();this.keysPreview.render(r);var a=this.properties.render(r);this.errors.render(a),this.keys.render(a),this._isDirty=!1;var s=Math.max(this.items.dy+30,230);this.xAxis.tickSize(-s,0),this.xAxisGrid.tickSize(-s,0),this.xGrid.call(this.xAxisGrid),this.xAxisElement.call(this.xAxis),this.svg.attr("height",s),this.timeIndicator.updateHeight(s)}}}]),e}();t["default"]=D},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=i(1),o=n(s),l=i(9),u=i(3),c=function(){function e(t,i,n,a,s,c){r(this,e),this.timer=i,this.initialDomain=n,this.tweenTime=a,this.onBrush=new u.Signal,this.margin={top:10,right:20,bottom:0,left:c.left},this.height=50-this.margin.top-this.margin.bottom+20,this.currentTime=this.timer.time,this.x=l.time.scale().range([0,s]),this.x.domain([0,this.timer.totalDuration]),this.xDisplayed=l.time.scale().range([0,s]),this.xDisplayed.domain(this.initialDomain),this.xAxis=l.svg.axis().scale(this.x).orient("top").tickSize(-5,0).tickFormat(o["default"].formatMinutes),this.svg=l.select(t.$timeline.get(0)).select(".timeline__header").append("svg").attr("width",s+this.margin.left+this.margin.right).attr("height",56),this.svgContainer=this.svg.append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.createBrushHandle(),this.createTimeHandle(),this.timer.durationChanged.add(this.onDurationChanged)}return a(e,[{key:"adaptDomainToDuration",value:function(e,t){var i=1e3*t,n=[e[0],e[1]];return n[0]=Math.min(n[0],i),n[1]=Math.min(n[1],i),n[0]=Math.max(n[0],0),n}},{key:"setDomain",value:function(){this.brush.x(this.x).extent(this.initialDomain),this.svgContainer.select(".brush").call(this.brush),this.onBrush.dispatch(this.initialDomain),this.render(),this.xDisplayed.domain(this.initialDomain)}},{key:"onDurationChanged",value:function(e){this.x.domain([0,this.timer.totalDuration]),this.xAxisElement.call(this.xAxis),this.initialDomain=this.adaptDomainToDuration(this.initialDomain,e),this.setDomain(this.initialDomain)}},{key:"createBrushHandle",value:function(){var e=this;this.xAxisElement=this.svgContainer.append("g").attr("class","x axis").attr("transform","translate(0,"+(this.margin.top+7)+")").call(this.xAxis);var t=function(){var t=e.brush.extent(),i=t[0].getTime(),n=t[1].getTime();e.initialDomain[0]=i,e.initialDomain[1]=n,e.setDomain(e.initialDomain)};this.brush=l.svg.brush().x(this.x).extent(this.initialDomain).on("brush",t),this.gBrush=this.svgContainer.append("g").attr("class","brush").call(this.brush).selectAll("rect").attr("height",20)}},{key:"render",value:function(){var e=this.svgContainer.selectAll(".time-indicator");e.attr("transform","translate("+this.xDisplayed(this.currentTime[0])+", 25)")}},{key:"createTimeHandle",value:function(){var e=this,t=function(){var t=l.event.sourceEvent;t.stopPropagation();var i=e.tweenTime,n=void 0!==t.x?t.x:t.clientX,r=e.xDisplayed.invert(n-e.margin.left);r=r.getTime(),r=Math.max(0,r);var a=!1;if(t.shiftKey){var s=r/1e3;a=o["default"].getClosestTime(i.data,s,"---non-existant",!1,!1,.3),a!==!1&&(a=1e3*a)}a===!1&&(a=r),e.timer.seek([a])},i=l.behavior.drag().origin(function(e){return e}).on("drag",t),n=this.svgContainer.selectAll(".time-indicator").data(this.currentTime);n.enter().append("rect").attr("x",0).attr("y",20).attr("width",e.xDisplayed(e.timer.totalDuration)).attr("height",50).attr("fill-opacity",0).on("click",function(){var t=l.mouse(this),i=e.xDisplayed.invert(t[0]);i=i.getTime(),i=Math.max(0,i),e.timer.seek([i])});var r=n.enter().append("g").attr("class","time-indicator").attr("transform","translate(-0.5,30)").call(i);r.append("rect").attr("class","time-indicator__line").attr("x",-.5).attr("y",0).attr("width",1).attr("height",1e3),r.append("path").attr("class","time-indicator__handle").attr("d","M -5 -3 L -5 5 L 0 10 L 5 5 L 5 -3 L -5 -3"),this.svgContainer.append("rect").attr("class","graph-mask").attr("x",-e.margin.left).attr("y",-e.margin.top).attr("width",e.margin.left-5).attr("height",e.height)}},{key:"resize",value:function(e){var t=e-this.margin.left-this.margin.right;this.svg.attr("width",t+this.margin.left+this.margin.right),this.x.range([0,t]),this.xDisplayed.range([0,t]),this.xAxisElement.call(this.xAxis)}}]),e}();t["default"]=c},function(e,t){e.exports=i},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t,n){i(this,e),this.timeline=t,this.container=n,this.timeSelection=this.container.selectAll(".time-indicator").data(this.timeline.currentTime),this.timeGrp=this.timeSelection.enter().append("svg").attr("class","time-indicator timeline__right-mask").attr("width",window.innerWidth-this.timeline.label_position_x).attr("height",442),this.timeSelection=this.timeGrp.append("rect").attr("class","time-indicator__line").attr("x",0).attr("y",-this.timeline.margin.top-5).attr("width",1).attr("height",1e3),this.timeSelection=this.container.selectAll(".time-indicator rect")}return n(e,[{key:"updateHeight",value:function(e){this.timeGrp.attr("height",e),this.timeSelection.attr("height",e+this.timeline.margin.top+5)}},{key:"render",value:function(){this.timeSelection.attr("transform","translate("+(this.timeline.x(this.timeline.currentTime[0])-.5)+",0)")}}]),e}();t["default"]=r},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=i(1),o=n(s),l=i(9),u=i(3),c=i(6),h=function(){function e(t,i){r(this,e),this.timeline=t,this.container=i,this.dy=10+this.timeline.margin.top,this.onUpdate=new u.Signal}return a(e,[{key:"render",value:function(){var e=this,t=e.timeline.tweenTime,i=function(){var t=l.select(this).datum();e.timeline.selectionManager.select(t)},n=function(t){var i=e.timeline.x.invert(l.event.x).getTime()/1e3,n=i-t.start;if(t.start+=n,t.end+=n,t.properties)for(var r=0;r<t.properties.length;r++)for(var a=t.properties[r],s=0;s<a.keys.length;s++){var o=a.keys[s];o.time+=n}t._isDirty=!0,e.onUpdate.dispatch()},r=function(i){l.event.sourceEvent.stopPropagation();var n=l.event.sourceEvent,r=e.timeline.x.invert(l.event.x).getTime()/1e3,a=!1;if(n.shiftKey&&(a=o["default"].getClosestTime(t.data,r,i.id,!1,t.timer)),!a){var s=r-i.start;a=i.start+s}i.start=a,i._isDirty=!0,e.onUpdate.dispatch()},a=function(i){l.event.sourceEvent.stopPropagation();var n=l.event.sourceEvent,r=e.timeline.x.invert(l.event.x).getTime()/1e3,a=!1;if(n.shiftKey&&(a=o["default"].getClosestTime(t.data,r,!1,!1,t.timer)),!a){var s=r-i.end;a=i.end+s}i.end=a,i._isDirty=!0,e.onUpdate.dispatch()},s=l.behavior.drag().origin(function(){var e=l.select(this);return{x:e.attr("x"),y:e.attr("y")}}).on("drag",r),u=l.behavior.drag().origin(function(){var e=l.select(this);return{x:e.attr("x"),y:e.attr("y")}}).on("drag",a),h=l.behavior.drag().origin(function(){var e=l.select(this);return{x:e.attr("x"),y:e.attr("y")}}).on("drag",n),d=1,p=this.container.selectAll(".line-grp").data(this.timeline.tweenTime.data,function(e){return e.id}),f=p.enter().append("g").attr("class","line-grp"),m=f.append("svg").attr("class","timeline__right-mask").attr("width",window.innerWidth-e.timeline.label_position_x).attr("height",e.timeline.lineHeight);m.append("rect").attr("class","bar").attr("id",function(){return o["default"].guid()}).attr("y",3).attr("height",14),m.append("rect").attr("class","bar-anchor bar-anchor--left").attr("y",2).attr("height",16).attr("width",6).call(s),m.append("rect").attr("class","bar-anchor bar-anchor--right").attr("y",2).attr("height",16).attr("width",6).call(u),e.dy=10+this.timeline.margin.top,p.attr("transform",function(t){var i=e.dy;if(e.dy+=e.timeline.lineHeight,!t.collapsed){var n=0;if(t.properties){var r=c.filter(t.properties,function(e){return e.keys.length});n=r.length}e.dy+=n*e.timeline.lineHeight}return"translate(0,"+i+")"});var v=function(e){return void 0!==e.start&&void 0!==e.end?!0:!1};return p.selectAll(".bar-anchor--left").filter(v).attr("x",function(t){return e.timeline.x(1e3*t.start)-1}).on("mousedown",function(){l.event.stopPropagation()}),p.selectAll(".bar-anchor--right").filter(v).attr("x",function(t){return e.timeline.x(1e3*t.end)-1}).on("mousedown",function(){l.event.stopPropagation()}),p.selectAll(".bar").filter(v).attr("x",function(t){return e.timeline.x(1e3*t.start)+d}).attr("width",function(t){return Math.max(0,1e3*(e.timeline.x(t.end)-e.timeline.x(t.start))-d)}).call(h).on("click",i).on("mousedown",function(){l.event.stopPropagation()}),f.append("text").attr("class","line-label").attr("x",e.timeline.label_position_x+10).attr("y",16).text(function(e){return e.label}).on("click",i).on("mousedown",function(){l.event.stopPropagation()}),f.append("text").attr("class","line__toggle").attr("x",e.timeline.label_position_x-10).attr("y",16).on("click",function(t){t.collapsed=!t.collapsed,e.onUpdate.dispatch()}),p.selectAll(".line__toggle").text(function(e){return e.collapsed?"▸":"▾"}),f.append("line").attr("class","line-separator").attr("x1",-e.timeline.margin.left).attr("x2",e.timeline.x(e.timeline.timer.totalDuration+100)).attr("y1",e.timeline.lineHeight).attr("y2",e.timeline.lineHeight),p.exit().remove(),p}}]),e}();t["default"]=h},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(9),s=function(){function e(t,i){n(this,e),this.timeline=t,this.container=i}return r(e,[{key:"render",value:function(e){var t=this,i=function(e){return e.properties?e.properties:[]},n=function(e){return e.name},r=e.selectAll(".keys-preview").data(i,n);r.enter().append("svg").attr("class","keys-preview timeline__right-mask").attr("width",window.innerWidth-t.timeline.label_position_x).attr("height",t.timeline.lineHeight);var s=function(){var e=a.select(this.parentNode.parentNode),t=e.datum();return t.collapsed===!0?"":"display: none;"};r.selectAll(".key--preview").attr("style",s);var o=function(e){return e.keys},l=function(e){return e.time},u=r.selectAll(".key--preview").data(o,l);u.enter().append("path").attr("class","key--preview").attr("style",s).attr("d","M 0 -4 L 4 0 L 0 4 L -4 0"),u.attr("transform",function(e){var i=t.timeline.x(1e3*e.time);i=parseInt(i,10);var n=11;return"translate("+i+","+n+")"}),u.exit().remove()}}]),e}();t["default"]=s},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=i(1),o=n(s),l=i(9),u=i(3),c=function(){function e(t){r(this,e),this.timeline=t,this.onKeyAdded=new u.Signal,this.subGrp=!1}return a(e,[{key:"render",value:function(e){var t=this,i=this.timeline.editor,n=i.tweenTime,r=function(e){return e.properties?e.properties.filter(function(e){return e.keys.length}):[]},a=function(e){return e.name},s=e.selectAll(".line-item").data(r,a),u=s.enter().append("g").attr("class","line-item");return t.subGrp=u,s.attr("transform",function(e,i){var n=(i+1)*t.timeline.lineHeight;return"translate(0,"+n+")"}),u.append("rect").attr("class","click-handler click-handler--property").attr("x",0).attr("y",0).attr("width",t.timeline.x(t.timeline.timer.totalDuration+100)).attr("height",t.timeline.lineHeight).on("dblclick",function(e){var i=this.parentNode.parentNode,r=l.select(i).datum(),a=e["default"]?e["default"]:0,s=l.mouse(this),u=t.timeline.x.invert(s[0]);u=u.getTime()/1e3;var c=o["default"].getPreviousKey(e.keys,u);c&&(a=c.val),e._line=r;var h={time:u,val:a,_property:e};n.options.defaultEase&&(h.ease=n.options.defaultEase),e.keys.push(h),e.keys=o["default"].sortKeys(e.keys),r._isDirty=!0,r._isDirty=!0;var d=this.parentNode;t.onKeyAdded.dispatch(h,d)}),u.append("svg").attr("class","line-item__keys timeline__right-mask").attr("width",window.innerWidth-t.timeline.label_position_x).attr("height",t.timeline.lineHeight).attr("fill","#f00"),u.append("text").attr("class","line-label line-label--small").attr("x",t.timeline.label_position_x+10).attr("y",15).text(function(e){return e.name}),u.append("line").attr("class","line-separator--secondary").attr("x1",-t.timeline.margin.left).attr("x2",t.timeline.x(t.timeline.timer.totalDuration+100)).attr("y1",t.timeline.lineHeight).attr("y2",t.timeline.lineHeight),e.selectAll(".line-item").attr("display",function(){var e=this.parentNode,t=l.select(e).datum();return t.collapsed?"none":"block"}),s.exit().remove(),s}}]),e}();t["default"]=c},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=i(1),o=n(s),l=i(9),u=i(3),c=i(6),h=function(){function e(t){r(this,e),this.timeline=t,this.onKeyUpdated=new u.Signal}return a(e,[{key:"selectNewKey",value:function(e,t){var i=this,n=l.select(t).selectAll(".key").filter(function(t){return t.time===e.time});n.length&&(l.selectAll(".key--selected").classed("key--selected",!1),n.classed("key--selected",!0),n=n[0][0],e._dom=n,i.timeline.selectionManager.select(e))}},{key:"render",value:function(e){var t=this,i=t.timeline.tweenTime,n=function(e){var n=l.event.sourceEvent,r=this.parentNode,a=r.parentNode.parentNode,s=l.select(r).datum(),u=l.select(a).datum(),h=e,d=t.timeline.x.domain()[0],p=l.mouse(this),f=e.time,m=t.timeline.x.invert(p[0]);m=m.getTime(),m=m/1e3-d/1e3,m=e.time+m;var v=t.timeline.selectionManager.getSelection(),g=!1,y=!1;v.length&&(g=v[0].time,y=v[v.length-1].time),v=c.filter(v,function(e){return c.isEqual(e,h)===!1});var b=!1;n.shiftKey&&(b=o["default"].getClosestTime(i.data,m,u.id,s.name,i.timer)),b===!1&&(b=m),e.time=b,s.keys=o["default"].sortKeys(s.keys);var _=e.time-f,k=function(e){var t=e._property;t._line._isDirty=!0,t.keys=o["default"].sortKeys(t.keys)},w=!1,x=!1;if(v.length){n.altKey&&g!==!1&&y!==!1&&(x=g===f,w=x?(y-e.time)/(y-f):(e.time-g)/(f-g));for(var T=0;T<v.length;T++){var D=v[T];w===!1?D.time+=_:x?D.time=y-(y-D.time)*w:D.time=g+(D.time-g)*w,k(D)}}u._isDirty=!0,t.onKeyUpdated.dispatch()},r=function(e){return e.keys},a=function(e){return e._id||(e._id=o["default"].guid()),e._id},s=e.select(".line-item__keys").selectAll(".key").data(r,a),u=function(){var e=l.event;e.sourceEvent&&(e=e.sourceEvent);var i=e.shiftKey;if(!l.event.type||"dragstart"!==l.event.type||!l.select(this).classed("key--selected")){var n=l.select(this).datum();n._dom=this,t.timeline.selectionManager.select(n,i)}},h=function(){t.timeline.editor.undoManager.addState()},d=l.behavior.drag().origin(function(e){return e}).on("drag",n).on("dragstart",u).on("dragend",h),p=s.enter().append("g").attr("class","key").attr("id",function(e){return e._id}).on("mousedown",function(){l.event.stopPropagation()}).call(d);e.selectAll(".key").attr("class",function(e){var t="key";if(l.select(this).classed("key--selected")&&(t+=" key--selected"),e.ease){var i=e.ease.split(".");2===i.length&&(t+=" "+i[1])}else t+=" easeOut";return t});var f=p.append("g").attr("class","ease-linear");f.append("path").attr("class","key__shape-arrow").attr("d","M 0 -6 L 6 0 L 0 6"),f.append("path").attr("class","key__shape-arrow").attr("d","M 0 -6 L -6 0 L 0 6");var m=p.append("g").attr("class","ease-in");m.append("path").attr("class","key__shape-rect").attr("d","M 0 -6 L 0 6 L 4 5 L 1 0 L 4 -5"),m.append("path").attr("class","key__shape-arrow").attr("d","M 0 -6 L -6 0 L 0 6");var v=p.append("g").attr("class","ease-out");v.append("path").attr("class","key__shape-rect").attr("d","M 0 -6 L 0 6 L -4 5 L -1 0 L -4 -5"),v.append("path").attr("class","key__shape-arrow").attr("d","M 0 -6 L 6 0 L 0 6");var g=p.append("g").attr("class","ease-inout");g.append("circle").attr("cx",0).attr("cy",0).attr("r",5),s.attr("transform",function(e){var i=t.timeline.x(1e3*e.time);i=parseInt(i,10);var n=10;return"translate("+i+","+n+")"}),s.exit().remove()}}]),e}();t["default"]=h},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){i(this,e),this.timeline=t}return n(e,[{key:"render",value:function(e){var t=this,i=t.timeline.properties.subGrp,n=function(e){return void 0!==e.errors};i.insert("svg",":first-child").attr("class","line-item__errors").attr("width",window.innerWidth-t.timeline.label_position_x).attr("height",t.timeline.lineHeight);var r=function(e){return e.errors},a=function(e){return e.time},s=e.filter(n).select(".line-item__errors").selectAll(".error").data(r,a);s.enter().append("rect").attr("class","error").attr("width",4).attr("height",t.timeline.lineHeight-1).attr("y","1"),e.selectAll(".error").attr("x",function(e){var i;return i=t.timeline.x(1e3*e.time)}),s.exit().remove()}}]),e}();t["default"]=r},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t,n,r){i(this,e),this.timeline=t,this.svg=n,this.margin=r,this.onMouseUp=this.onMouseUp.bind(this),this.init()}return n(e,[{key:"onMouseUp",value:function(){this.svg.selectAll(".selection").remove(),$("body").css({"user-select":"all"})}},{key:"init",value:function(){var e=this;this.svg.on("mousedown",function(){var t=d3.mouse(this);t[0]<e.timeline.margin.left||(e.svg.append("rect").attr({"class":"selection",x:t[0],y:t[1],width:0,height:0}),e.timeline.selectionManager.reset(),$("body").css({"user-select":"none"}))}).on("mousemove",function(){var t=e.svg.select(".selection");if(!t.empty()){var i=d3.mouse(this),n={x:parseInt(t.attr("x"),10),y:parseInt(t.attr("y"),10),width:parseInt(t.attr("width"),10),height:parseInt(t.attr("height"),10)};i[0]=Math.max(e.margin.left,i[0]);var r={x:i[0]-n.x,y:i[1]-n.y};r.x<1||2*r.x<n.width?(n.x=i[0],n.width-=r.x):n.width=r.x,r.y<1||2*r.y<n.height?(n.y=i[1],n.height-=r.y):n.height=r.y,t.attr(n),n.x-=e.margin.left;var a=6;n.timeStart=e.timeline.x.invert(n.x-a).getTime()/1e3,n.timeEnd=e.timeline.x.invert(n.x+n.width+a).getTime()/1e3;var s=e.svg[0][0].getBoundingClientRect();d3.selectAll(".key--selected").classed("key--selected",!1),e.timeline.selectionManager.reset();var o=[];d3.selectAll(".key").each(function(e){var t=d3.select(this.parentNode.parentNode.parentNode).datum(),i=d3.select(this).datum();if(i._dom=this,t.collapsed!==!0){var r=d3.select(this)[0][0].getBoundingClientRect(),a=r.top-s.top;e.time>=n.timeStart&&e.time<=n.timeEnd&&(a>=n.y&&a<=n.y+n.height||a+10>=n.y&&a+10<=n.y+n.height)&&(d3.select(this).classed("key--selected",!0),o.push(i))}}),e.timeline.selectionManager.select(o)}}),$(window).on("mouseup",this.onMouseUp)}}]),e}();t["default"]=r},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();i(18);var s=i(19),o=n(s),l=i(3),u=i(32),c=function(){function e(t){r(this,e),this.editor=t,this.render=this.render.bind(this),this.addProperty=this.addProperty.bind(this),this.onSelect=this.onSelect.bind(this),this.onKeyAdded=this.onKeyAdded.bind(this),this.timeline=this.editor.timeline,this.timer=this.editor.timer,this.selectionManager=t.selectionManager,this.$el=$(u()),this.$container=this.$el.find(".properties-editor__main"),this.keyAdded=new l.Signal,this.keyRemoved=new l.Signal,this.items=[],this.parentElement=t.el,this.parentElement.addClass("properties-is-closed"),this.parentElement.append(this.$el),this.selectionManager.onSelect.add(this.onSelect),this.$el.keypress(function(e){return e.stopPropagation()})}return a(e,[{key:"onKeyAdded",value:function(){this.keyAdded.dispatch()}},{key:"onSelect",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];if(this.items.forEach(function(e){e.remove()}),this.items=[],this.$container.empty(),e instanceof Array)for(var t=0;t<e.length;t++)this.addProperty(e[t]);else this.addProperty(e);
this.items.length&&this.parentElement.removeClass("properties-is-closed")}},{key:"addProperty",value:function(e){var t=new o["default"](this.editor,this.$container,e);t.keyAdded.add(this.onKeyAdded),this.items.push(t)}},{key:"render",value:function(e,t){t&&this.items.forEach(function(e){e.update()})}}]),e}();t["default"]=c},function(e,t){e.exports=n},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=i(20),o=n(s),l=i(27),u=n(l),c=i(30),h=n(c),d=i(3),p=function(){function e(t,i,n){r(this,e),this.editor=t,this.$el=i,this.onKeyAdded=this.onKeyAdded.bind(this),this.timeline=t.timeline,this.timer=t.timer,this.selectionManager=t.selectionManager,this.keyAdded=new d.Signal,this.items=[],this.numberProp=!1,this.tweenProp=!1;var a=!1,s=!1,o=!1;n._property&&(s=n._property,o=s._line,a=n),n.id&&(o=n);var l=!1;s&&(l=s.name);var u=this.getContainer(o),c=u;for(var h in o.properties)if(o.properties.hasOwnProperty(h)){var p=o.properties[h];if(!l||p.name===l){var f=this.getGroupContainer(p,u),m=this.addNumberProperty(p,o,a,f);if(this.items.push(m),p.name===l&&(c=f),l){var v=this.addTweenProperty(p,o,a,c,s);this.items.push(v)}}}}return a(e,[{key:"onKeyAdded",value:function(){this.keyAdded.dispatch()}},{key:"getGroupContainer",value:function(e,t){var i,n,r;if(!e.group)return r="property-grp--general",i=t.find("."+r),i.length?i:(n=this.createGroupContainer(r),t.append(n),n);var a=e.group.replace(/\s+/g,"-").toLowerCase();return r="property-grp--"+a,i=t.find("."+r),i.length?i:(n=this.createGroupContainer(r,e.group),t.append(n),n)}},{key:"createGroupContainer",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],i=$('<div class="property-grp '+e+'"></div>');return t&&i.append('<h3 class="property-grp__title">'+t+"</h3>"),i}},{key:"getContainer",value:function(e){var t=!1;return e.id&&(t=$("#property--"+e.id),t.length||(t=t=$('<div class="properties__wrapper" id="property--'+e.id+'"></div>'),this.$el.append(t),e.label&&t.append('<h2 class="properties-editor__title">'+e.label+"</h2>"))),t===!1&&(t=$('<div class="properties__wrapper" id="no-item"></div>'),this.$el.append(t)),t}},{key:"remove",value:function(){this.items.forEach(function(e){e.remove()}),this.keyAdded&&this.keyAdded.dispose(),delete this.editor,delete this.$el,delete this.timeline,delete this.timer,delete this.selectionManager,delete this.keyAdded,delete this.items,delete this.numberProp,delete this.tweenProp}},{key:"addNumberProperty",value:function(e,t,i,n){var r=o["default"];e.type&&"color"===e.type&&(r=u["default"]);var a=new r(e,t,this.editor,i);return a.keyAdded.add(this.onKeyAdded),n.append(a.$el),a}},{key:"addTweenProperty",value:function(e,t,i,n,r){var a=this,s=new h["default"](e,t,this.editor,i,this.timeline);return n.append(s.$el),s.$el.find("[data-action-remove]").click(function(e){e.preventDefault();var n=r.keys.indexOf(i);n>-1&&(r.keys.splice(n,1),i._dom&&a.editor.propertiesEditor.keyRemoved.dispatch(i),t._isDirty=!0)}),s}},{key:"update",value:function(){for(var e=0;e<this.items.length;e++){var t=this.items[e];t.update()}}}]),e}();t["default"]=p},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=function f(e,t,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var r=Object.getPrototypeOf(e);return null===r?void 0:f(r,t,i)}if("value"in n)return n.value;var a=n.get;return void 0===a?void 0:a.call(i)};i(18);var u=i(21),c=n(u),h=i(22),d=i(23),p=function(e){function t(e,i,n){var s=arguments.length<=3||void 0===arguments[3]?!1:arguments[3];r(this,t);var o=a(this,Object.getPrototypeOf(t).call(this,e,i,n,s));return o.onInputChange=o.onInputChange.bind(o),o.$input=o.$el.find("input"),o}return s(t,e),o(t,[{key:"getInputVal",value:function(){return parseFloat(this.$el.find("input").val())}},{key:"render",value:function(){var e=this;l(Object.getPrototypeOf(t.prototype),"render",this).call(this);var i=this.getCurrentVal(),n={id:this.instance_property.name,label:this.instance_property.label||this.instance_property.name,val:i},r=d(n);this.$el=$(r),this.$el.find(".property__key").click(this.onKeyClick);var a=this.$el.find("input"),s=function(){e.editor.undoManager.addState()},o={changeCallback:function(){return e.onInputChange()},endCallback:function(){return s()}};"min"in this.instance_property&&(o.min=this.instance_property.min),"max"in this.instance_property&&(o.max=this.instance_property.max);var u=new h(a.get(0),o);a.data("draggable",u),a.change(this.onInputChange)}},{key:"remove",value:function(){l(Object.getPrototypeOf(t.prototype),"render",this).call(this),this.$input.data("draggable")&&this.$input.data("draggable").destroy(),delete this.$input,delete this.$el}},{key:"update",value:function(){l(Object.getPrototypeOf(t.prototype),"render",this).call(this);var e=this.getCurrentVal(),i=this.$input.data("draggable");i?i.set(e.toFixed(3)):this.$input.val(e.toFixed(3))}}]),t}(c["default"]);t["default"]=p},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=i(1),o=n(s),l=i(3),u=i(6),c=function(){function e(t,i,n){var a=arguments.length<=3||void 0===arguments[3]?!1:arguments[3];r(this,e),this.instance_property=t,this.lineData=i,this.editor=n,this.key_val=a,this.onInputChange=this.onInputChange.bind(this),this.onKeyClick=this.onKeyClick.bind(this),this.timer=n.timer,this.keyAdded=new l.Signal,this.render(),this.$key=this.$el.find(".property__key")}return a(e,[{key:"onKeyClick",value:function(e){e.preventDefault();var t=this.getCurrentVal();this.addKey(t)}},{key:"getInputVal",value:function(){return this.$el.find("input").val()}},{key:"getCurrentVal",value:function(){var e=this.instance_property.val,t=this.instance_property.name;return this.key_val?this.key_val.val:void 0!==this.lineData.values&&this.lineData.values[t]?this.lineData.values[t]:e}},{key:"onInputChange",value:function(){var e=this.getInputVal(),t=this.timer.getCurrentTime()/1e3;if(this.key_val&&(t=this.key_val.time),this.instance_property.keys&&this.instance_property.keys.length){var i=u.find(this.instance_property.keys,function(e){return e.time===t});i?i.val=e:this.addKey(e)}else this.instance_property.val=e,this.lineData.values[this.instance_property.name]=e,this.lineData.object&&(t=this.timer.getCurrentTime()/1e3,this.lineData.object.update(t-this.lineData.start));this.lineData._isDirty=!0}},{key:"getCurrentKey",value:function(){var e=this.timer.getCurrentTime()/1e3;if(!this.instance_property||!this.instance_property.keys)return!1;if(0===this.instance_property.keys.length)return!1;for(var t=0;t<this.instance_property.keys.length;t++){var i=this.instance_property.keys[t];if(i.time===e)return i}return!1}},{key:"addKey",value:function(e){var t=this.editor.tweenTime,i=this.timer.getCurrentTime()/1e3,n={time:i,val:e};t.options.defaultEase&&(n.ease=t.options.defaultEase),this.instance_property.keys.push(n),this.instance_property.keys=o["default"].sortKeys(this.instance_property.keys),this.lineData._isDirty=!0,this.keyAdded.dispatch()}},{key:"render",value:function(){this.values=void 0!==this.lineData.values?this.lineData.values:{}}},{key:"update",value:function(){var e=this.getCurrentKey();this.$key.toggleClass("property__key--active",e)}},{key:"remove",value:function(){this.keyAdded&&this.keyAdded.dispose(),delete this.instance_property,delete this.lineData,delete this.editor,delete this.key_val,delete this.timer,delete this.keyAdded,delete this.$key}}]),e}();t["default"]=c},function(e,t){e.exports=r},function(e,t,i){var n=i(24);e.exports=function(){var e=new n.Template({code:function(e,t,i){var n=this;return n.b(i=i||""),n.b('<div class="property property--number">'),n.b("\n"+i),n.b('  <button class="property__key"></button>'),n.b("\n"+i),n.b('  <label for="'),n.b(n.v(n.f("id",e,t,0))),n.b('" class="property__label">'),n.b(n.v(n.f("label",e,t,0))),n.b("</label>"),n.b("\n"+i),n.b('  <input type="number" id="'),n.b(n.v(n.f("id",e,t,0))),n.b('" class="property__input" value="'),n.b(n.v(n.f("val",e,t,0))),n.b('" />'),n.b("\n"+i),n.b("</div>"),n.b("\n"),n.fl()},partials:{},subs:{}},'<div class="property property--number">\n  <button class="property__key"></button>\n  <label for="{{id}}" class="property__label">{{label}}</label>\n  <input type="number" id="{{id}}" class="property__input" value="{{val}}" />\n</div>\n',n);return e.render.apply(e,arguments)}},function(e,t,i){var n=i(25);n.Template=i(26).Template,n.template=n.Template,e.exports=n},function(e,t,i){!function(e){function t(e){"}"===e.n.substr(e.n.length-1)&&(e.n=e.n.substring(0,e.n.length-1))}function i(e){return e.trim?e.trim():e.replace(/^\s*|\s*$/g,"")}function n(e,t,i){if(t.charAt(i)!=e.charAt(0))return!1;for(var n=1,r=e.length;r>n;n++)if(t.charAt(i+n)!=e.charAt(n))return!1;return!0}function r(t,i,n,o){var l=[],u=null,c=null,h=null;for(c=n[n.length-1];t.length>0;){if(h=t.shift(),c&&"<"==c.tag&&!(h.tag in k))throw new Error("Illegal content in < super tag.");if(e.tags[h.tag]<=e.tags.$||a(h,o))n.push(h),h.nodes=r(t,h.tag,n,o);else{if("/"==h.tag){if(0===n.length)throw new Error("Closing tag without opener: /"+h.n);if(u=n.pop(),h.n!=u.n&&!s(h.n,u.n,o))throw new Error("Nesting error: "+u.n+" vs. "+h.n);return u.end=h.i,l}"\n"==h.tag&&(h.last=0==t.length||"\n"==t[0].tag)}l.push(h)}if(n.length>0)throw new Error("missing closing tag: "+n.pop().n);return l}function a(e,t){for(var i=0,n=t.length;n>i;i++)if(t[i].o==e.n)return e.tag="#",!0}function s(e,t,i){for(var n=0,r=i.length;r>n;n++)if(i[n].c==e&&i[n].o==t)return!0}function o(e){var t=[];for(var i in e)t.push('"'+u(i)+'": function(c,p,t,i) {'+e[i]+"}");return"{ "+t.join(",")+" }"}function l(e){var t=[];for(var i in e.partials)t.push('"'+u(i)+'":{name:"'+u(e.partials[i].name)+'", '+l(e.partials[i])+"}");return"partials: {"+t.join(",")+"}, subs: "+o(e.subs)}function u(e){return e.replace(y,"\\\\").replace(m,'\\"').replace(v,"\\n").replace(g,"\\r").replace(b,"\\u2028").replace(_,"\\u2029")}function c(e){return~e.indexOf(".")?"d":"f"}function h(e,t){var i="<"+(t.prefix||""),n=i+e.n+w++;return t.partials[n]={name:e.n,partials:{}},t.code+='t.b(t.rp("'+u(n)+'",c,p,"'+(e.indent||"")+'"));',n}function d(e,t){t.code+="t.b(t.t(t."+c(e.n)+'("'+u(e.n)+'",c,p,0)));'}function p(e){return"t.b("+e+");"}var f=/\S/,m=/\"/g,v=/\n/g,g=/\r/g,y=/\\/g,b=/\u2028/,_=/\u2029/;e.tags={"#":1,"^":2,"<":3,$:4,"/":5,"!":6,">":7,"=":8,_v:9,"{":10,"&":11,_t:12},e.scan=function(r,a){function s(){y.length>0&&(b.push({tag:"_t",text:new String(y)}),y="")}function o(){for(var t=!0,i=w;i<b.length;i++)if(t=e.tags[b[i].tag]<e.tags._v||"_t"==b[i].tag&&null===b[i].text.match(f),!t)return!1;return t}function l(e,t){if(s(),e&&o())for(var i,n=w;n<b.length;n++)b[n].text&&((i=b[n+1])&&">"==i.tag&&(i.indent=b[n].text.toString()),b.splice(n,1));else t||b.push({tag:"\n"});_=!1,w=b.length}function u(e,t){var n="="+T,r=e.indexOf(n,t),a=i(e.substring(e.indexOf("=",t)+1,r)).split(" ");return x=a[0],T=a[a.length-1],r+n.length-1}var c=r.length,h=0,d=1,p=2,m=h,v=null,g=null,y="",b=[],_=!1,k=0,w=0,x="{{",T="}}";for(a&&(a=a.split(" "),x=a[0],T=a[1]),k=0;c>k;k++)m==h?n(x,r,k)?(--k,s(),m=d):"\n"==r.charAt(k)?l(_):y+=r.charAt(k):m==d?(k+=x.length-1,g=e.tags[r.charAt(k+1)],v=g?r.charAt(k+1):"_v","="==v?(k=u(r,k),m=h):(g&&k++,m=p),_=k):n(T,r,k)?(b.push({tag:v,n:i(y),otag:x,ctag:T,i:"/"==v?_-x.length:k+T.length}),y="",k+=T.length-1,m=h,"{"==v&&("}}"==T?k++:t(b[b.length-1]))):y+=r.charAt(k);return l(_,!0),b};var k={_t:!0,"\n":!0,$:!0,"/":!0};e.stringify=function(t,i,n){return"{code: function (c,p,i) { "+e.wrapMain(t.code)+" },"+l(t)+"}"};var w=0;e.generate=function(t,i,n){w=0;var r={code:"",subs:{},partials:{}};return e.walk(t,r),n.asString?this.stringify(r,i,n):this.makeTemplate(r,i,n)},e.wrapMain=function(e){return'var t=this;t.b(i=i||"");'+e+"return t.fl();"},e.template=e.Template,e.makeTemplate=function(e,t,i){var n=this.makePartials(e);return n.code=new Function("c","p","i",this.wrapMain(e.code)),new this.template(n,t,this,i)},e.makePartials=function(e){var t,i={subs:{},partials:e.partials,name:e.name};for(t in i.partials)i.partials[t]=this.makePartials(i.partials[t]);for(t in e.subs)i.subs[t]=new Function("c","p","t","i",e.subs[t]);return i},e.codegen={"#":function(t,i){i.code+="if(t.s(t."+c(t.n)+'("'+u(t.n)+'",c,p,1),c,p,0,'+t.i+","+t.end+',"'+t.otag+" "+t.ctag+'")){t.rs(c,p,function(c,p,t){',e.walk(t.nodes,i),i.code+="});c.pop();}"},"^":function(t,i){i.code+="if(!t.s(t."+c(t.n)+'("'+u(t.n)+'",c,p,1),c,p,1,0,0,"")){',e.walk(t.nodes,i),i.code+="};"},">":h,"<":function(t,i){var n={partials:{},code:"",subs:{},inPartial:!0};e.walk(t.nodes,n);var r=i.partials[h(t,i)];r.subs=n.subs,r.partials=n.partials},$:function(t,i){var n={subs:{},code:"",partials:i.partials,prefix:t.n};e.walk(t.nodes,n),i.subs[t.n]=n.code,i.inPartial||(i.code+='t.sub("'+u(t.n)+'",c,p,i);')},"\n":function(e,t){t.code+=p('"\\n"'+(e.last?"":" + i"))},_v:function(e,t){t.code+="t.b(t.v(t."+c(e.n)+'("'+u(e.n)+'",c,p,0)));'},_t:function(e,t){t.code+=p('"'+u(e.text)+'"')},"{":d,"&":d},e.walk=function(t,i){for(var n,r=0,a=t.length;a>r;r++)n=e.codegen[t[r].tag],n&&n(t[r],i);return i},e.parse=function(e,t,i){return i=i||{},r(e,"",[],i.sectionTags||[])},e.cache={},e.cacheKey=function(e,t){return[e,!!t.asString,!!t.disableLambda,t.delimiters,!!t.modelGet].join("||")},e.compile=function(t,i){i=i||{};var n=e.cacheKey(t,i),r=this.cache[n];if(r){var a=r.partials;for(var s in a)delete a[s].instance;return r}return r=this.generate(this.parse(this.scan(t,i.delimiters),t,i),t,i),this.cache[n]=r}}(t)},function(e,t,i){!function(e){function t(e,t,i){var n;return t&&"object"==typeof t&&(void 0!==t[e]?n=t[e]:i&&t.get&&"function"==typeof t.get&&(n=t.get(e))),n}function i(e,t,i,n,r,a){function s(){}function o(){}s.prototype=e,o.prototype=e.subs;var l,u=new s;u.subs=new o,u.subsText={},u.buf="",n=n||{},u.stackSubs=n,u.subsText=a;for(l in t)n[l]||(n[l]=t[l]);for(l in n)u.subs[l]=n[l];r=r||{},u.stackPartials=r;for(l in i)r[l]||(r[l]=i[l]);for(l in r)u.partials[l]=r[l];return u}function n(e){return String(null===e||void 0===e?"":e)}function r(e){return e=n(e),c.test(e)?e.replace(a,"&amp;").replace(s,"&lt;").replace(o,"&gt;").replace(l,"&#39;").replace(u,"&quot;"):e}e.Template=function(e,t,i,n){e=e||{},this.r=e.code||this.r,this.c=i,this.options=n||{},this.text=t||"",this.partials=e.partials||{},this.subs=e.subs||{},this.buf=""},e.Template.prototype={r:function(e,t,i){return""},v:r,t:n,render:function(e,t,i){return this.ri([e],t||{},i)},ri:function(e,t,i){return this.r(e,t,i)},ep:function(e,t){var n=this.partials[e],r=t[n.name];if(n.instance&&n.base==r)return n.instance;if("string"==typeof r){if(!this.c)throw new Error("No compiler available.");r=this.c.compile(r,this.options)}if(!r)return null;if(this.partials[e].base=r,n.subs){t.stackText||(t.stackText={});for(key in n.subs)t.stackText[key]||(t.stackText[key]=void 0!==this.activeSub&&t.stackText[this.activeSub]?t.stackText[this.activeSub]:this.text);r=i(r,n.subs,n.partials,this.stackSubs,this.stackPartials,t.stackText)}return this.partials[e].instance=r,r},rp:function(e,t,i,n){var r=this.ep(e,i);return r?r.ri(t,i,n):""},rs:function(e,t,i){var n=e[e.length-1];if(!h(n))return void i(e,t,this);for(var r=0;r<n.length;r++)e.push(n[r]),i(e,t,this),e.pop()},s:function(e,t,i,n,r,a,s){var o;return h(e)&&0===e.length?!1:("function"==typeof e&&(e=this.ms(e,t,i,n,r,a,s)),o=!!e,!n&&o&&t&&t.push("object"==typeof e?e:t[t.length-1]),o)},d:function(e,i,n,r){var a,s=e.split("."),o=this.f(s[0],i,n,r),l=this.options.modelGet,u=null;if("."===e&&h(i[i.length-2]))o=i[i.length-1];else for(var c=1;c<s.length;c++)a=t(s[c],o,l),void 0!==a?(u=o,o=a):o="";return r&&!o?!1:(r||"function"!=typeof o||(i.push(u),o=this.mv(o,i,n),i.pop()),o)},f:function(e,i,n,r){for(var a=!1,s=null,o=!1,l=this.options.modelGet,u=i.length-1;u>=0;u--)if(s=i[u],a=t(e,s,l),void 0!==a){o=!0;break}return o?(r||"function"!=typeof a||(a=this.mv(a,i,n)),a):r?!1:""},ls:function(e,t,i,r,a){var s=this.options.delimiters;return this.options.delimiters=a,this.b(this.ct(n(e.call(t,r)),t,i)),this.options.delimiters=s,!1},ct:function(e,t,i){if(this.options.disableLambda)throw new Error("Lambda features disabled.");return this.c.compile(e,this.options).render(t,i)},b:function(e){this.buf+=e},fl:function(){var e=this.buf;return this.buf="",e},ms:function(e,t,i,n,r,a,s){var o,l=t[t.length-1],u=e.call(l);return"function"==typeof u?n?!0:(o=this.activeSub&&this.subsText&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text,this.ls(u,l,i,o.substring(r,a),s)):u},mv:function(e,t,i){var r=t[t.length-1],a=e.call(r);return"function"==typeof a?this.ct(n(a.call(r)),r,i):a},sub:function(e,t,i,n){var r=this.subs[e];r&&(this.activeSub=e,r(t,i,this,n),this.activeSub=!1)}};var a=/&/g,s=/</g,o=/>/g,l=/\'/g,u=/\"/g,c=/[&<>\"\']/,h=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}}(t)},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=function p(e,t,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var r=Object.getPrototypeOf(e);return null===r?void 0:p(r,t,i)}if("value"in n)return n.value;var a=n.get;return void 0===a?void 0:a.call(i)};i(18);var u=i(21),c=n(u);i(28);var h=i(29),d=function(e){function t(e,i,n){var s=arguments.length<=3||void 0===arguments[3]?!1:arguments[3];r(this,t);var o=a(this,Object.getPrototypeOf(t).call(this,e,i,n,s));return o.onInputChange=o.onInputChange.bind(o),o.$input=o.$el.find("input"),o}return s(t,e),o(t,[{key:"render",value:function(){var e=this;l(Object.getPrototypeOf(t.prototype),"render",this).call(this);var i=this.getCurrentVal(),n={id:this.instance_property.name,label:this.instance_property.label||this.instance_property.name,val:i},r=h(n);this.$el=$(r),this.$el.find(".property__key").click(this.onKeyClick);var a=this.$el.find("input");a.spectrum({allowEmpty:!1,showAlpha:!0,clickoutFiresChange:!1,preferredFormat:"rgb",change:function(){e.editor.undoManager.addState()},move:function(t){1===t._a?a.val(t.toHexString()):a.val(t.toRgbString()),e.onInputChange()}}),a.change(this.onInputChange)}},{key:"remove",value:function(){l(Object.getPrototypeOf(t.prototype),"remove",this).call(this),this.$el.find("input").spectrum("destroy"),delete this.$el,delete this.$input}},{key:"update",value:function(){l(Object.getPrototypeOf(t.prototype),"update",this).call(this);var e=this.getCurrentVal();this.$input.val(e),this.$input.spectrum("set",e)}}]),t}(c["default"]);t["default"]=d},function(e,t){e.exports=a},function(e,t,i){var n=i(24);e.exports=function(){var e=new n.Template({code:function(e,t,i){var n=this;return n.b(i=i||""),n.b('<div class="property property--number">'),n.b("\n"+i),n.b('  <button class="property__key"></button>'),n.b("\n"+i),n.b('  <label for="'),n.b(n.v(n.f("id",e,t,0))),n.b('" class="property__label">'),n.b(n.v(n.f("label",e,t,0))),n.b("</label>"),n.b("\n"+i),n.b('  <input id="'),n.b(n.v(n.f("id",e,t,0))),n.b('" class="property__input" value="'),n.b(n.v(n.f("val",e,t,0))),n.b('" />'),n.b("\n"+i),n.b("</div>"),n.b("\n"),n.fl()},partials:{},subs:{}},'<div class="property property--number">\n  <button class="property__key"></button>\n  <label for="{{id}}" class="property__label">{{label}}</label>\n  <input id="{{id}}" class="property__input" value="{{val}}" />\n</div>\n',n);return e.render.apply(e,arguments)}},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();i(18);var a=i(31),s=function(){function e(t,i,r){var a=arguments.length<=3||void 0===arguments[3]?!1:arguments[3],s=arguments.length<=4||void 0===arguments[4]?!1:arguments[4];n(this,e),this.instance_property=t,this.lineData=i,this.editor=r,this.key_val=a,this.timeline=s,this.onChange=this.onChange.bind(this),this.timer=this.editor.timer,this.$time=!1,this.$el=!1,this.render()}return r(e,[{key:"remove",value:function(){delete this.$el,delete this.instance_property,delete this.lineData,delete this.editor,delete this.key_val,delete this.timeline,delete this.timer,delete this.$time}},{key:"render",value:function(){var e=this,t=this;this.key_val.ease||(this.key_val.ease="Quad.easeOut");for(var i={id:this.instance_property.name+"_tween",val:this.key_val.ease,time:this.key_val.time.toFixed(3),options:["Linear.easeNone"],selected:function(){return this.toString()===t.key_val.ease?"selected":""}},n=["Quad","Cubic","Quart","Quint"],r=0;r<n.length;r++){var s=n[r];i.options.push(s+".easeOut"),i.options.push(s+".easeIn"),i.options.push(s+".easeInOut")}this.$el=$(a(i)),this.$time=this.$el.find(".property__key-time strong"),this.$time.keypress(function(t){13===t.charCode&&(t.preventDefault(),e.$time.blur(),e.updateKeyTime(e.$time.text()))}),this.$time.on("click",function(){return document.execCommand("selectAll",!1,null)}),this.$el.find("select").change(this.onChange)}},{key:"updateKeyTime",value:function(e){var t=parseFloat(e);isNaN(t)&&(t=this.key_val.time),this.$time.text(t),this.key_val.time=t,this.onChange()}},{key:"onChange",value:function(){var e=this.$el.find("select").val();this.key_val.ease=e,this.editor.undoManager.addState(),this.lineData._isDirty=!0,this.timeline._isDirty=!0}},{key:"update",value:function(){this.$time.html(this.key_val.time.toFixed(3))}}]),e}();t["default"]=s},function(e,t,i){var n=i(24);e.exports=function(){var e=new n.Template({code:function(e,t,i){var n=this;return n.b(i=i||""),n.b('<div class="property property--tween">'),n.b("\n"+i),n.b('  <label for="'),n.b(n.v(n.f("id",e,t,0))),n.b('" class="property__label">easing</label>'),n.b("\n"+i),n.b('  <div class="property__select">'),n.b("\n"+i),n.b('    <div class="custom-select">'),n.b("\n"+i),n.b('      <select id="'),n.b(n.v(n.f("id",e,t,0))),n.b('">'),n.b("\n"+i),n.s(n.f("options",e,t,1),e,t,0,212,279,"{{ }}")&&(n.rs(e,t,function(e,t,n){n.b('        <option value="'),n.b(n.v(n.d(".",e,t,0))),n.b('" '),n.b(n.v(n.f("selected",e,t,0))),n.b(">"),n.b(n.v(n.d(".",e,t,0))),n.b("</option>"),n.b("\n"+i)}),e.pop()),n.b("      </select>"),n.b("\n"+i),n.b("    </div>"),n.b("\n"+i),n.b("  </div>"),n.b("\n"+i),n.b("</div>"),n.b("\n"+i),n.b('<div class="properties-editor__actions actions">'),n.b("\n"+i),n.b('  <span class="property__key-time">key at <strong class="property__key-input" contenteditable="true">'),n.b(n.v(n.f("time",e,t,0))),n.b("</strong> seconds</span>"),n.b("\n"+i),n.b('  <a href="#" class="actions__item" data-action-remove>Remove key</a>'),n.b("\n"+i),n.b("</div>"),n.fl()},partials:{},subs:{}},'<div class="property property--tween">\n  <label for="{{id}}" class="property__label">easing</label>\n  <div class="property__select">\n    <div class="custom-select">\n      <select id="{{id}}">\n        {{#options}}\n        <option value="{{.}}" {{selected}}>{{.}}</option>\n        {{/options}}\n      </select>\n    </div>\n  </div>\n</div>\n<div class="properties-editor__actions actions">\n  <span class="property__key-time">key at <strong class="property__key-input" contenteditable="true">{{time}}</strong> seconds</span>\n  <a href="#" class="actions__item" data-action-remove>Remove key</a>\n</div>',n);return e.render.apply(e,arguments)}},function(e,t,i){var n=i(24);e.exports=function(){var e=new n.Template({code:function(e,t,i){var n=this;return n.b(i=i||""),n.b('<div class="properties-editor">'),n.b("\n"+i),n.b('  <a href="#" class="menu-item menu-item--toggle-side" data-action="toggle"><i class="icon-toggle"></i></a>'),n.b("\n"+i),n.b('  <div class="properties-editor__main"></div>'),n.b("\n"+i),n.b("</div>"),n.b("\n"),n.fl()},partials:{},subs:{}},'<div class="properties-editor">\n  <a href="#" class="menu-item menu-item--toggle-side" data-action="toggle"><i class="icon-toggle"></i></a>\n  <div class="properties-editor__main"></div>\n</div>\n',n);return e.render.apply(e,arguments)}},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(34).saveAs||i(34),s=function(){function e(t,i,r){n(this,e),this.tweenTime=t,this.$timeline=i,this.editor=r,this.timer=this.tweenTime.timer,this.initExport(),this.initToggle()}return r(e,[{key:"initToggle",value:function(){var e=this.editor.el,t=!1,i=this.$timeline.find('[data-action="toggle"]');i.click(function(n){return n.preventDefault(),t=!t,i.toggleClass("menu-item--toggle-up",t),e.toggleClass("timeline-is-closed",t),window.dispatchEvent(new Event("resize"))});var n=$(".properties-editor",e).find('[data-action="toggle"]');n.click(function(t){var i;return t.preventDefault(),i=!e.hasClass("properties-is-closed"),e.toggleClass("properties-is-closed",i),window.dispatchEvent(new Event("resize"))})}},{key:"initExport",value:function(){var e=this.editor.exporter;this.$timeline.find('[data-action="export"]').click(function(t){t.preventDefault();var i=e.getJSON(),n=new Blob([i],{type:"text/json;charset=utf-8"});a(n,"data.json")})}}]),e}();t["default"]=s},function(e,t){e.exports=s},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t,n){var r=this;i(this,e),this.tweenTime=t,this.$timeline=n,this.timer=this.tweenTime.timer,this.$time=this.$timeline.find(".control--time"),this.$time_end=this.$timeline.find(".control--time-end"),this.initControls(),this.$time_end.val(this.tweenTime.timer.getDuration()),$(document).keypress(function(e){32===e.charCode&&r.playPause()})}return n(e,[{key:"playPause",value:function(){var e;this.timer.toggle(),e=this.$timeline.find(".control--play-pause"),e.toggleClass("icon-pause",this.timer.is_playing),e.toggleClass("icon-play",!this.timer.is_playing)}},{key:"initControls",value:function(){var e=this,t=this.$timeline.find(".control--play-pause");t.click(function(t){t.preventDefault(),e.playPause()});var i=this.$timeline.find(".control--first");i.click(function(t){t.preventDefault(),e.timer.seek([0])});var n=this.$timeline.find(".control--last");n.click(function(t){t.preventDefault();var i=e.tweenTime.getTotalDuration();e.timer.seek([1e3*i])}),this.$time.change(function(){var t=1e3*parseFloat(e.$time.val(),10);e.timer.seek([t])}),this.$time_end.change(function(){var t=parseFloat(e.$time_end.val(),10);e.timer.setDuration(t)})}},{key:"render",value:function(e,t){if(t){var i=e/1e3;this.$time.val(i.toFixed(3))}}}]),e}();t["default"]=r},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(9),s=i(3),o=i(6),l=function(){function e(t){n(this,e),this.tweenTime=t,this.selection=[],this.onSelect=new s.Signal}return r(e,[{key:"select",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];if(this.addDataRelations(),t||(this.selection=[]),e instanceof Array)for(var i=0;i<e.length;i++){var n=e[i];this.selection.push(n)}else this.selection.push(e);this.removeDuplicates(),this.highlightItems(),this.sortSelection(),this.onSelect.dispatch(this.selection,t)}},{key:"getSelection",value:function(){return this.selection}},{key:"removeDuplicates",value:function(){for(var e=[],t=0;t<this.selection.length;t++){for(var i=this.selection[t],n=!1,r=0;r<e.length;r++){var a=e[r];if(o.isEqual(i,a)){n=!0;break}}n===!1&&e.push(i)}this.selection=e}},{key:"removeItem",value:function(e){if("string"==typeof e){var t=o.find(this.selection,function(t){return t._id===e});if(t)return this.removeItem(t)}var i=this.selection.indexOf(e);i>-1&&this.selection.splice(i,1),this.triggerSelect()}},{key:"sortSelection",value:function(){var e=function(e,t){return e.time&&t.time?e.time<t.time?-1:e.time>t.time?1:0:0};this.selection=this.selection.sort(e)}},{key:"reset",value:function(){this.selection=[],this.highlightItems(),this.onSelect.dispatch(this.selection,!1)}},{key:"triggerSelect",value:function(){this.onSelect.dispatch(this.selection,!1)}},{key:"addDataRelations",value:function(){for(var e=this.tweenTime.data,t=0;t<e.length;t++)for(var i=e[t],n=0;n<i.properties.length;n++){var r=i.properties[n];r._line=i;for(var a=0;a<r.keys.length;a++){var s=r.keys[a];s._property=r}}}},{key:"highlightItems",value:function(){a.selectAll(".bar--selected").classed("bar--selected",!1),a.selectAll(".key--selected").classed("key--selected",!1);for(var e=0;e<this.selection.length;e++){var t=this.selection[e];if(t._dom){var i=a.select(t._dom);
i.classed("bar")?i.classed("bar--selected",!0):i.classed("key")&&i.classed("key--selected",!0)}}}}]),e}();t["default"]=l},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(t){i(this,e),this.editor=t}return n(e,[{key:"getData",value:function(){var e=this.editor.tweenTime,t=this.editor.timeline.x.domain(),i=t[0],n=t[1];return{settings:{time:e.timer.getCurrentTime(),duration:e.timer.getDuration(),domain:[i.getTime(),n.getTime()]},data:e.data}}},{key:"getJSON",value:function(){var e=this.editor.options,t=function(t,i){return 0===t.indexOf("_")?void 0:void 0!==e.json_replacer?e.json_replacer(t,i):i},i=this.getData();return JSON.stringify(i,t,2)}}]),e}();t["default"]=r},function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();i(18);var a=function(){function e(t){var i=this;n(this,e),this.editor=t,this.history_max=100,this.history=[],this.current_index=0,this.addState(),$(document).keydown(function(e){90===e.keyCode&&(e.metaKey||e.ctrlKey)&&(e.shiftKey?i.redo():i.undo())})}return r(e,[{key:"undo",value:function(){return this.current_index<=0?!1:(this.current_index-=1,void this.setState(this.current_index))}},{key:"redo",value:function(){return this.current_index>=this.history.length-1?!1:(this.current_index+=1,void this.setState(this.current_index))}},{key:"addState",value:function(){var e=JSON.parse(this.editor.exporter.getJSON());this.current_index+1<this.history.length&&this.history.splice(this.current_index+1,this.history.length-1),this.history.push(e),this.history.length>this.history_max&&this.history.shift(),this.current_index=this.history.length-1}},{key:"setState",value:function(e){for(var t=this.history[e],i=t.data,n=this.editor.tweenTime,r=0;r<i.length;r++){var a=i[r];if(n.data[r])for(var s=0;s<a.properties.length;s++){var o=a.properties[s];if(n.data[r].properties[s])for(var l=n.data[r].properties[s].keys,u=0;u<o.keys.length;u++){var c=o.keys[u];l[u]?(l[u].time=c.time,l[u].val=c.val,l[u].ease=c.ease):l[u]=c}else n.data[r].properties[s]=o}else n.data[r]=a;n.data[r]._isDirty=!0}this.editor.render(!1,!0)}}]),e}();t["default"]=a},function(e,t,i){var n=i(24);e.exports=function(){var e=new n.Template({code:function(e,t,i){var n=this;return n.b(i=i||""),n.b('<div class="timeline">'),n.b("\n"+i),n.b('  <nav class="timeline__menu">'),n.b("\n"+i),n.b('    <a href="#" class="menu-item" data-action="export">Export</a>'),n.b("\n"+i),n.b('    <a href="#" class="menu-item menu-item--toggle" data-action="toggle"><i class="icon-toggle"></i></a>'),n.b("\n"+i),n.b("  </nav>"),n.b("\n"+i),n.b('  <div class="timeline__controls controls">'),n.b("\n"+i),n.b('    <a href="#" class="control control--first icon-first"></a>'),n.b("\n"+i),n.b('    <a href="#" class="control control--play-pause icon-play"></a>'),n.b("\n"+i),n.b('    <a href="#" class="control control--last icon-last"></a>'),n.b("\n"+i),n.b('    <input type="text" class="control control--input control--time" /> <span class="control__time-separator">/</span> <input type="text" class="control control--input control--time-end" />'),n.b("\n"+i),n.b("  </div>"),n.b("\n"+i),n.b('  <div class="timeline__header">'),n.b("\n"),n.b("\n"+i),n.b("  </div>"),n.b("\n"+i),n.b('  <div class="timeline__main">'),n.b("\n"),n.b("\n"+i),n.b("  </div>"),n.b("\n"+i),n.b("</div>"),n.b("\n"),n.fl()},partials:{},subs:{}},'<div class="timeline">\n  <nav class="timeline__menu">\n    <a href="#" class="menu-item" data-action="export">Export</a>\n    <a href="#" class="menu-item menu-item--toggle" data-action="toggle"><i class="icon-toggle"></i></a>\n  </nav>\n  <div class="timeline__controls controls">\n    <a href="#" class="control control--first icon-first"></a>\n    <a href="#" class="control control--play-pause icon-play"></a>\n    <a href="#" class="control control--last icon-last"></a>\n    <input type="text" class="control control--input control--time" /> <span class="control__time-separator">/</span> <input type="text" class="control control--input control--time-end" />\n  </div>\n  <div class="timeline__header">\n\n  </div>\n  <div class="timeline__main">\n\n  </div>\n</div>\n',n);return e.render.apply(e,arguments)}}])});
//# sourceMappingURL=TweenTime.Editor.min.js.map